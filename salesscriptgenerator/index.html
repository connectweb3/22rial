<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blockscom Sales Script Generator</title>
    <link rel="stylesheet" href="../home.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <style>
        /* Tool Specific Overrides */
        .result-box {
            white-space: pre-wrap;
            font-family: var(--font-body);
            font-size: 1.1rem;
            color: #fff;
            min-height: 200px;
        }

        .spinner {
            display: none;
            width: 20px;
            height: 20px;
            border: 4px solid var(--card-bg);
            border-top: 4px solid var(--accent-color);
            border-radius: 50%;
            animation: spin 1s infinite linear;
            margin-left: 10px;
        }

        .btn-generate {
            width: 100%;
            font-size: 1.2rem;
            padding: 1.5rem;
        }

        @keyframes spin {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        .tab-btn.active {
            background-color: var(--accent-color);
            color: #000;
        }
    </style>
</head>

<body>
    <div class="scanlines"></div>
    <div class="container">
        <header style="text-align: center; margin-bottom: 3rem;">
            <a href="../index.html" class="back-btn" style="position: absolute; left: 0; top: 0;">‚Üê Home</a>
            <h1>Sales Script Generator</h1>
            <p class="subtitle">AI-Powered PFP Sales Pitcher</p>
        </header>

        <main>
            <div class="card">
                <div class="input-group">
                    <label for="targetUrl">TARGET URL / SOCIALS</label>
                    <input type="text" id="targetUrl" placeholder="https://twitter.com/..." autocomplete="off">
                </div>
                <button class="btn-primary btn-generate" onclick="generateScript()">
                    GENERATE PITCH <div class="spinner"></div>
                </button>
            </div>

            <div id="resultArea" class="hidden">
                <div class="card">
                    <div class="flex" style="margin-bottom: 1rem; justify-content: space-between; align-items: center;">
                        <div class="tabs">
                            <button class="tab-btn active" onclick="switchTab('pitch')">SALES PITCH</button>
                            <button class="tab-btn" onclick="switchTab('analysis')">AI ANALYSIS</button>
                        </div>
                        <button class="btn-secondary mini-btn" onclick="copyToClipboard()"
                            style="font-size: 0.8rem; padding: 8px 15px;">
                            üìã COPY TEXT
                        </button>
                    </div>
                    <div id="outputContent" class="result-box"></div>
                </div>
            </div>
        </main>

        <footer>
            Blockscom Media Internal Tool &copy; 2025
        </footer>
    </div>

    <script>
        // Configuration
        const API_KEY = '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';
        const MODEL = 'openai/gpt-5.1';

        // State
        let currentResult = {
            pitch: '',
            analysis: ''
        };

        // Active tab tracker
        let activeTab = 'pitch';

        async function generateScript() {
            const urlInput = document.getElementById('targetUrl');
            const url = urlInput.value.trim();
            const btn = document.querySelector('.btn-generate');
            const spinner = document.querySelector('.spinner');
            const resultArea = document.getElementById('resultArea');
            const outputDiv = document.getElementById('outputContent');

            if (!url) {
                alert('Please enter a target URL.');
                return;
            }

            // Set Loading State
            btn.disabled = true;
            spinner.style.display = 'inline-block';
            btn.innerHTML = 'GENERATING... <div class="spinner" style="display:inline-block"></div>';
            resultArea.classList.add('hidden');

            try {
                const response = await fetchPrompt(url);

                // Process output
                const parts = parseResponse(response);
                currentResult = parts;

                // Show Result
                switchTab('pitch');
                resultArea.classList.remove('hidden');

            } catch (error) {
                console.error(error);
                alert('Error generating script: ' + error.message);
            } finally {
                btn.disabled = false;
                btn.innerHTML = 'GENERATE PITCH <div class="spinner"></div>';
            }
        }

        async function fetchPrompt(targetUrl) {
            const prompt = `
            You are a helpful, human web3 enthusiast reaching out to a project you admire. You work for Blockscom Media.
            
            **Our Company Profile:**
            - Name: Blockscom Media
            - Website: https://blockscom.xyz/
            - Core Focus: **PFP NFT Collections for Communities**
            - Services: High-quality PFP Art, NFT Collection Generation, Metadata, Smart Contracts, Mint Sites.
            - **PRICING:** Our packages start from as low as **$50 - $300** depending on the number of traits and complexity.
            
            **The Task:**
            I will provide you with a Target URL of a potential client (a project, community, or brand). You need to:
            1.  **Analyze** the target to understand their community vibe and brand identity.
            2.  **Create a Personal, Human Outreach Message** (Not a robotic sales pitch). 
                - **Context**: Imagine you are sending a DM on Twitter or Discord.
                - **Tone**: Friendly, casual but professional, genuine, human-to-human. Avoid "AI buzzwords" like "We are thrilled to offer" or "Unlock your potential". Talk like a normal person.
                - **Goal**: Suggest that a custom PFP collection would be awesome for their community.
                - **Key Info to Drop Naturally**: 
                    - We can build the whole collection (Art, Dev, Mint).
                    - It's super affordable (**$50 - $300** range).
                    - "Check out our site blockscom.xyz to see our work".
            
            **Target URL:** ${targetUrl}
            
            **Output Format:**
            Please strictly follow this format with the specific separators:

            [ANALYSIS_START]
            (Write your brief, informal analysis of why they need a PFP collection)
            [ANALYSIS_END]
            
            [PITCH_START]
            (Write the PERSONAL, HUMAN outreach script here. Do NOT include subject lines unless it's an email. Make it sound like a DM.)
            [PITCH_END]
            `;

            const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                method: "POST",
                headers: {
                    "Authorization": `Bearer ${API_KEY}`,
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({
                    "model": MODEL,
                    "messages": [
                        { "role": "system", "content": "You are a friendly web3 creative, not a corporate sales bot." },
                        { "role": "user", "content": prompt }
                    ]
                })
            });

            const data = await response.json();
            if (data.error) throw new Error(data.error.message || 'API Error');
            return data.choices[0].message.content;
        }

        function parseResponse(text) {
            const analysisMatch = text.match(/\[ANALYSIS_START\]([\s\S]*?)\[ANALYSIS_END\]/);
            const pitchMatch = text.match(/\[PITCH_START\]([\s\S]*?)\[PITCH_END\]/);

            return {
                analysis: analysisMatch ? formatMarkdown(analysisMatch[1].trim()) : "Could not parse analysis. Showing raw output:\n\n" + text,
                pitch: pitchMatch ? formatMarkdown(pitchMatch[1].trim()) : text
            };
        }

        function formatMarkdown(text) {
            // Simple markdown formatter
            return text
                .replace(/^# (.*$)/gim, '<h3>$1</h3>')
                .replace(/^## (.*$)/gim, '<h3>$1</h3>')
                .replace(/^### (.*$)/gim, '<h4>$1</h4>')
                .replace(/\*\*(.*?)\*\*/gim, '<strong>$1</strong>')
                .replace(/\*(.*?)\*/gim, '<em>$1</em>')
                .replace(/^\- (.*$)/gim, '<li>$1</li>')
                .replace(/\n\n/g, '<br><br>');
        }

        function switchTab(tab) {
            const btns = document.querySelectorAll('.tab-btn');
            const output = document.getElementById('outputContent');

            activeTab = tab;
            btns.forEach(b => b.classList.remove('active'));

            if (tab === 'pitch') {
                btns[0].classList.add('active'); // First button is Pitch
                output.innerHTML = currentResult.pitch;
            } else {
                btns[1].classList.add('active'); // Second button is Analysis
                output.innerHTML = currentResult.analysis;
            }
        }

        function copyToClipboard() {
            const content = activeTab === 'pitch' ? currentResult.pitch : currentResult.analysis;
            // Strip HTML breaks for clipboard if we want plain text, or keep them. 
            // Usually copying plain text is better for pasting into DMs.
            const plainText = content.replace(/<br>/g, '\n').replace(/<[^>]*>?/gm, '');

            navigator.clipboard.writeText(plainText).then(() => {
                const btn = document.querySelector('.mini-btn');
                const originalText = btn.innerText;
                btn.innerText = '‚úÖ COPIED!';
                setTimeout(() => {
                    btn.innerText = originalText;
                }, 2000);
            }).catch(err => {
                console.error('Failed to copy: ', err);
                // Fallback for some non-secure contexts if needed, but clipboard API is standard now
                alert('Failed to copy to clipboard');
            });
        }
    </script>
</body>

</html>