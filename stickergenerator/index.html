<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sticker Prompt Generator - NFT Tools</title>
    <link rel="stylesheet" href="../home.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&family=VT323&display=swap" rel="stylesheet">
    <style>
        .options-group {
            display: flex;
            gap: 20px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .option-label {
            display: flex;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            padding: 15px 25px;
            border: 2px solid var(--border-color);
            background: var(--input-bg);
            transition: all 0.2s;
            font-family: var(--font-heading);
            font-size: 0.8rem;
            color: var(--text-color);
        }

        .option-label:hover {
            border-color: var(--accent-color);
            box-shadow: 4px 4px 0px #000;
        }

        input[type="radio"] {
            display: none;
        }

        input[type="radio"]:checked+.option-label {
            background: var(--accent-color);
            color: #000;
            border-color: var(--accent-color);
            box-shadow: inset 4px 4px 0px rgba(0, 0, 0, 0.2);
        }

        .preview-box {
            max-width: 300px;
            margin: 20px auto;
            border: 2px dashed var(--border-color);
            padding: 10px;
            background: rgba(0, 0, 0, 0.3);
            display: none;
        }

        .preview-box img {
            max-width: 100%;
            height: auto;
            display: block;
        }

        .result-area {
            background-color: var(--input-bg);
            border: 2px solid var(--accent-color);
            color: var(--accent-color);
            font-family: monospace;
            padding: 1rem;
            min-height: 100px;
            margin-top: 1rem;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .d-none {
            display: none !important;
        }
    </style>
</head>

<body>
    <div class="scanlines"></div>
    <div class="container">
        <h1>Sticker Prompt Generator</h1>
        <p class="subtitle">Turn any image into a sticker prompt</p>
        <a href="../index.html" class="back-btn" style="margin-bottom: 2rem;">&larr; Back to Tools</a>

        <div class="card">
            <h2>1. Upload Reference Image</h2>
            <div class="upload-area" id="drop-zone">
                <p>Drag & Drop Image Here<br><span style="font-size: 0.8rem; color: #666;">(or click to upload)</span>
                </p>
                <input type="file" id="file-input" accept="image/*" class="d-none">
            </div>
            <div id="preview-container" class="preview-box">
                <img id="image-preview" alt="Preview">
            </div>
        </div>

        <div class="card">
            <h2>2. Sticker Options</h2>
            <div class="options-group">
                <label>
                    <input type="radio" name="stickerType" value="head" checked>
                    <span class="option-label">ğŸ‘¤ Head Only</span>
                </label>
                <label>
                    <input type="radio" name="stickerType" value="full">
                    <span class="option-label">ğŸ§ Full Body</span>
                </label>
            </div>

            <div style="margin-top: 20px; text-align: center;">
                <label for="reactionSelect"
                    style="display: block; margin-bottom: 10px; color: var(--secondary-accent);">Select Reaction /
                    Theme</label>
                <select id="reactionSelect" style="max-width: 300px; margin: 0 auto; display: block;">
                    <option value="Neutral/Standard">ğŸ˜ Standard / Neutral</option>
                    <option value="Happy/Smiling">ğŸ˜„ Happy / Smiling</option>
                    <option value="Sad/Crying">ğŸ˜¢ Sad / Crying</option>
                    <option value="Angry/Mad">ğŸ˜¡ Angry / Mad</option>
                    <option value="Surprised/Shocked">ğŸ˜² Surprised / Shocked</option>
                    <option value="Cool/Sunglasses">ğŸ˜ Cool / Sunglasses</option>
                    <option disabled>--- Crypto Themes ---</option>
                    <option value="Crypto Pump/Green Candles">ğŸ“ˆ Crypto Pump (Green Candles)</option>
                    <option value="HODL/Diamond Hands">ğŸ’ HODL (Diamond Hands)</option>
                    <option value="To The Moon/Rocket">ğŸš€ To The Moon (Rocket)</option>
                    <option value="Wen Button">ğŸ”´ Wen Button (Pressing Big Red Button)</option>
                    <option value="Wen Lambo">ğŸï¸ Wen Lambo (Dreaming of Lambo)</option>
                    <option value="Buy The Dip">ğŸ“‰ Buy The Dip</option>
                    <option value="McDonald's Hat">ğŸŸ McDonald's Hat (Bear Market)</option>
                    <option value="Rekt/Red Candles">ğŸ“‰ Rekt (Red Candles)</option>
                    <option value="Rug Pulled">ğŸ˜± Rug Pulled (Shocked)</option>
                    <option value="GM/WAGMI">â˜€ï¸ GM / WAGMI</option>
                    <option value="Chad/Gigachad">ğŸ’ª Chad / Gigachad</option>
                    <option value="Pepe Style">ğŸ¸ Pepe / Frog Style</option>
                    <option value="Laser Eyes">ğŸ‘€ Laser Eyes</option>
                    <option disabled>--- More Memes ---</option>
                    <option value="This Is Fine">ğŸ”¥ This Is Fine (Burning)</option>
                    <option value="Copium">ğŸ˜· Copium (Breathing Mask)</option>
                    <option value="FOMO">ğŸƒ FOMO (Running/Sweating)</option>
                    <option value="Bullish">ğŸ‚ Bullish (Bull)</option>
                    <option value="Bearish">ğŸ» Bearish (Bear)</option>
                    <option value="Whale">ğŸ‹ Whale (Big Holder)</option>
                    <option value="Paper Hands">ğŸ§» Paper Hands (Weak)</option>
                    <option value="100x Gem">ğŸ’ 100x Gem / Moonshot</option>
                    <option value="Dev Do Something">ğŸ¥¢ Dev Do Something (Poking)</option>
                    <option value="Sipping Tea">â˜• Sipping Tea / None of my business</option>
                    <option value="Mind Blown">ğŸ¤¯ Mind Blown</option>
                    <option value="Clown World">ğŸ¤¡ Clown World</option>
                    <option value="NFA">âš ï¸ NFA (Not Financial Advice)</option>
                </select>
            </div>

            <div class="center-actions" style="text-align: center; margin-top: 2rem;">
                <button id="generate-btn" class="btn-primary" style="font-size: 1.2rem; padding: 1rem 2rem;">
                    <span id="btn-text">Generate Sticker Prompt</span>
                    <span id="btn-loader" class="d-none">â³ Processing...</span>
                </button>
            </div>
        </div>

        <div class="card" id="result-section">
            <h2>Generated Prompt</h2>
            <div id="output-prompt" class="result-area"></div>
            <button id="copy-btn" class="btn-success" style="margin-top: 1rem;">Copy to Clipboard</button>
        </div>

        <footer>
            &copy; 2025 NFT Tools Suite. All rights reserved.
        </footer>
    </div>

    <script>
        // Configuration
        const API_KEY = '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';
        const MODEL = 'openai/gpt-5-mini';

        // DOM Elements
        const dropZone = document.getElementById('drop-zone');
        const fileInput = document.getElementById('file-input');
        const previewContainer = document.getElementById('preview-container');
        const imagePreview = document.getElementById('image-preview');
        const generateBtn = document.getElementById('generate-btn');
        const btnText = document.getElementById('btn-text');
        const btnLoader = document.getElementById('btn-loader');
        const outputPrompt = document.getElementById('output-prompt');
        const copyBtn = document.getElementById('copy-btn');
        const reactionSelect = document.getElementById('reactionSelect');

        let currentFile = null;

        // Drag & Drop
        function setupDragDrop(element) {
            ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
                element.addEventListener(eventName, preventDefaults, false);
            });

            function preventDefaults(e) {
                e.preventDefault();
                e.stopPropagation();
            }

            ['dragenter', 'dragover'].forEach(eventName => {
                element.addEventListener(eventName, () => element.style.borderColor = 'var(--accent-color)', false);
            });

            ['dragleave', 'drop'].forEach(eventName => {
                element.addEventListener(eventName, () => element.style.borderColor = 'var(--border-color)', false);
            });

            element.addEventListener('drop', (e) => {
                const dt = e.dataTransfer;
                if (dt.files.length > 0) {
                    handleFile(dt.files[0]);
                }
            }, false);
        }

        setupDragDrop(dropZone);

        // Click Upload
        dropZone.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => {
            if (e.target.files.length > 0) {
                handleFile(e.target.files[0]);
            }
        });

        function handleFile(file) {
            if (!file || !file.type.startsWith('image/')) return;
            currentFile = file;
            const reader = new FileReader();
            reader.onload = (e) => {
                imagePreview.src = e.target.result;
                previewContainer.style.display = 'block';
            };
            reader.readAsDataURL(file);
        }

        function fileToBase64(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onload = () => resolve(reader.result);
                reader.onerror = error => reject(error);
            });
        }

        function setLoading(isLoading) {
            generateBtn.disabled = isLoading;
            if (isLoading) {
                btnText.classList.add('d-none');
                btnLoader.classList.remove('d-none');
            } else {
                btnText.classList.remove('d-none');
                btnLoader.classList.add('d-none');
            }
        }

        // Generate Logic
        generateBtn.addEventListener('click', async () => {
            if (!currentFile) {
                alert('Please upload an image first!');
                return;
            }

            setLoading(true);
            outputPrompt.textContent = 'Analyzing image...';

            try {
                const type = document.querySelector('input[name="stickerType"]:checked').value;
                const typeText = type === 'head' ? "Head only sticker" : "Full body sticker";
                const reaction = reactionSelect.value;

                const base64Image = await fileToBase64(currentFile);

                const response = await fetch("https://openrouter.ai/api/v1/chat/completions", {
                    method: "POST",
                    headers: {
                        "Authorization": `Bearer ${API_KEY}`,
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({
                        "model": MODEL,
                        "messages": [
                            {
                                "role": "user",
                                "content": [
                                    {
                                        "type": "text",
                                        "text": `You are an expert AI sticker prompt generator.
                                        Task: Analyze the attached image and create a text prompt to regenerate it as a HIGH QUALITY STICKER.
                                        
                                        User Preferences:
                                        - Type: ${typeText}
                                        - Reaction/Theme: ${reaction}
                                        
                                        Style instructions:
                                        - Die-cut sticker with distinct white border.
                                        - Vector illustration style, flat colors, clean lines.
                                        - Vibrant and expressive.
                                        - White background.
                                        - If a specific reaction or crypto theme is selected, ensure the prompt explicitly describes the facial expression, props (like rocket for Moon, or red charts for Rekt), and mood to match.
                                        
                                        CRITICAL: Output ONLY the raw prompt text. Do not use markdown formatting (no **Prompt:** or similar). Do NOT include conversational filler like "Here is the prompt". Just the prompt string.`
                                    },
                                    {
                                        "type": "image_url",
                                        "image_url": {
                                            "url": base64Image
                                        }
                                    }
                                ]
                            }
                        ]
                    })
                });

                if (!response.ok) {
                    const errData = await response.json();
                    throw new Error(errData.error?.message || 'API Request Failed');
                }

                const data = await response.json();
                let text = data.choices[0]?.message?.content || "No text generated.";

                // Cleanup: Remove common conversational prefixes if the AI ignores instructions
                text = text.replace(/^(Here is|Sure, here is|This is|The prompt is).*?:\s*/i, '');
                text = text.replace(/^\*\*Prompt:\*\*\s*/i, '');
                text = text.replace(/^"|"$/g, ''); // Remove surrounding quotes if present

                outputPrompt.textContent = text.trim();

            } catch (error) {
                console.error(error);
                outputPrompt.textContent = `Error: ${error.message}`;
                alert('Generation failed. Check console/result area.');
            } finally {
                setLoading(false);
            }
        });

        // Copy Logic
        copyBtn.addEventListener('click', () => {
            const text = outputPrompt.textContent;
            if (!text) return;
            navigator.clipboard.writeText(text).then(() => {
                const originalText = copyBtn.innerText;
                copyBtn.innerText = 'COPIED!';
                setTimeout(() => {
                    copyBtn.innerText = originalText;
                }, 2000);
            });
        });

    </script>
</body>

</html>